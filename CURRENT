#!/bin/bash
# Script to calculate current CPU, Memory, and Disk utilization in tabular form on RHEL8

# Check if the 'sar' command is available
if ! command -v sar >/dev/null 2>&1; then
  echo "Error: 'sar' command not found. Please install the sysstat package."
  exit 1
fi

# Set sampling interval and count.
# Using COUNT=2 helps ensure a current sample (first sample may be from boot time)
INTERVAL=1
COUNT=2

echo "=================== System Utilization Report ==================="
echo ""

# CPU Utilization
echo ">> CPU Utilization:"
cpu_output=$(sar -u $INTERVAL $COUNT)
cpu_header=$(echo "$cpu_output" | head -n 1)
cpu_data=$(echo "$cpu_output" | tail -n 1)
echo "$cpu_header"
echo "$cpu_data" | column -t
echo ""

# Memory Utilization
echo ">> Memory Utilization:"
mem_output=$(sar -r $INTERVAL $COUNT)
mem_header=$(echo "$mem_output" | head -n 1)
mem_data=$(echo "$mem_output" | tail -n 1)
echo "$mem_header"
echo "$mem_data" | column -t
echo ""

# Disk Utilization
echo ">> Disk I/O Utilization:"
disk_output=$(sar -d $INTERVAL $COUNT)
disk_header=$(echo "$disk_output" | head -n 1)
disk_data=$(echo "$disk_output" | tail -n 1)
echo "$disk_header"
echo "$disk_data" | column -t
echo ""
echo "=================================================================="
